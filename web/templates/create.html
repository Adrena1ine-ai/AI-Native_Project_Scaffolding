{% extends "base.html" %}

{% block title %}–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç ‚Äî AI Toolkit{% endblock %}

{% block content %}
<div class="page-header">
    <span class="page-title-icon">üÜï</span>
    <h1 class="page-title">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</h1>
    <p class="page-subtitle">
        –ó–∞–ø–æ–ª–Ω–∏ —Ñ–æ—Ä–º—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
    </p>
</div>

<div class="card" style="max-width: 800px; margin: 0 auto;">
    <form id="createForm">
        <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ -->
        <div class="form-group">
            <label class="form-label">üìÅ –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</label>
            <input type="text" class="form-input" name="name" id="projectName"
                   placeholder="my_awesome_bot" required
                   pattern="[a-zA-Z0-9_-]+"
                   title="–¢–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, _ –∏ -">
            <div class="form-hint">
                –¢–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, _ –∏ -
            </div>
        </div>
        
        <!-- –ü—É—Ç—å -->
        <div class="form-group">
            <label class="form-label">üìç –ö—É–¥–∞ —Å–æ–∑–¥–∞—Ç—å?</label>
            <input type="text" class="form-input" name="path" id="projectPath"
                   value="{{ home_path }}" required>
            <div class="form-hint">
                –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ, –≥–¥–µ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –ø—Ä–æ–µ–∫—Ç
            </div>
        </div>
        
        <!-- –®–∞–±–ª–æ–Ω -->
        <div class="form-group">
            <label class="form-label">üì¶ –í—ã–±–µ—Ä–∏ —à–∞–±–ª–æ–Ω</label>
            <div class="radio-cards">
                {% for key, tmpl in templates.items() %}
                <label class="radio-card">
                    <input type="radio" name="template" value="{{ key }}" 
                           {% if key == 'bot' %}checked{% endif %}>
                    <div class="radio-card-content">
                        <span class="radio-card-icon">{{ tmpl.icon }}</span>
                        <span class="radio-card-title">{{ tmpl.name }}</span>
                        <span class="radio-card-desc">{{ tmpl.description }}</span>
                    </div>
                </label>
                {% endfor %}
            </div>
        </div>
        
        <!-- IDE -->
        <div class="form-group">
            <label class="form-label">üñ•Ô∏è –ö–∞–∫—É—é IDE –∏—Å–ø–æ–ª—å–∑—É–µ—à—å?</label>
            <div class="radio-cards">
                {% for key, cfg in ide_configs.items() %}
                <label class="radio-card">
                    <input type="radio" name="ide" value="{{ key }}"
                           {% if key == 'all' %}checked{% endif %}>
                    <div class="radio-card-content">
                        <span class="radio-card-icon">{{ cfg.icon }}</span>
                        <span class="radio-card-title">{{ cfg.name }}</span>
                    </div>
                </label>
                {% endfor %}
            </div>
        </div>
        
        <!-- –û–ø—Ü–∏–∏ -->
        <div class="form-group">
            <label class="form-label">‚öôÔ∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏</label>
            <div class="checkbox-group">
                <label class="checkbox-item">
                    <input type="checkbox" name="include_docker" checked>
                    <span>üê≥ Docker</span>
                </label>
                <label class="checkbox-item">
                    <input type="checkbox" name="include_ci" checked>
                    <span>üöÄ CI/CD</span>
                </label>
                <label class="checkbox-item">
                    <input type="checkbox" name="include_git" checked>
                    <span>üîó Git</span>
                </label>
            </div>
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∞ -->
        <button type="submit" class="btn btn-primary btn-lg btn-block" id="submitBtn">
            ‚ú® –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
        </button>
    </form>
    
    <!-- –õ–æ–∞–¥–µ—Ä -->
    <div class="loader" id="loader">
        <div class="spinner"></div>
        <span>–°–æ–∑–¥–∞—ë–º –ø—Ä–æ–µ–∫—Ç...</span>
    </div>
    
    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
    <div id="result" class="hidden" style="margin-top: 2rem;"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const form = document.getElementById('createForm');
    const loader = document.getElementById('loader');
    const result = document.getElementById('result');
    const submitBtn = document.getElementById('submitBtn');
    
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–∞–¥–µ—Ä
        submitBtn.disabled = true;
        loader.classList.add('active');
        result.classList.add('hidden');
        
        // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        const formData = new FormData(form);
        const data = {
            name: formData.get('name'),
            path: formData.get('path'),
            template: formData.get('template'),
            ide: formData.get('ide'),
            include_docker: formData.get('include_docker') === 'on',
            include_ci: formData.get('include_ci') === 'on',
            include_git: formData.get('include_git') === 'on',
        };
        
        try {
            const response = await fetch('/api/create', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            
            const res = await response.json();
            
            if (res.success) {
                result.innerHTML = `
                    <div class="alert alert-success">
                        <span class="alert-icon">‚úÖ</span>
                        <span>${res.message}</span>
                    </div>
                    
                    <h3 style="margin: 1.5rem 0 1rem;">üìç –ü—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É:</h3>
                    <div class="output-box">${res.path}</div>
                    
                    <h3 style="margin: 1.5rem 0 1rem;">üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:</h3>
                    <div class="steps">
                        ${res.next_steps.map((step, i) => `
                            <div class="step">
                                <span class="step-number">${i + 1}</span>
                                <span>${step}</span>
                                <button class="step-copy" onclick="copyToClipboard('${step}')">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="margin-top: 2rem; text-align: center;">
                        <a href="/create" class="btn btn-primary">üÜï –°–æ–∑–¥–∞—Ç—å –µ—â—ë</a>
                        <a href="/health?path=${encodeURIComponent(res.path)}" class="btn btn-outline">üè• –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</a>
                    </div>
                `;
            } else {
                result.innerHTML = `
                    <div class="alert alert-error">
                        <span class="alert-icon">‚ùå</span>
                        <span>${res.message}</span>
                    </div>
                `;
            }
            
        } catch (error) {
            result.innerHTML = `
                <div class="alert alert-error">
                    <span class="alert-icon">‚ùå</span>
                    <span>–û—à–∏–±–∫–∞: ${error.message}</span>
                </div>
            `;
        }
        
        // –°–∫—Ä—ã–≤–∞–µ–º –ª–æ–∞–¥–µ—Ä
        loader.classList.remove('active');
        submitBtn.disabled = false;
        result.classList.remove('hidden');
    });
</script>
{% endblock %}

